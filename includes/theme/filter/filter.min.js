(function(oesFilter,$,undefined){let current_filter_post_ids=[];let selected_filter=[];oesFilter.filterFromURL=function(){if(typeof oes_filter!=="undefined"){const urlSearchParams=new URLSearchParams(window.location.search),params=Object.fromEntries(urlSearchParams.entries());let filtered=false;for(const k in params){const values=params[k].split(",");for(let i=0;i<values.length;i++){let filterName=k;if(k.substring(0,5)==="oesf_")filterName=k.substring(5);if(oes_filter.hasOwnProperty(filterName)){oesFilter.apply(values[i],filterName);filtered=true}}}if(!filtered)init()}};oesFilter.applyAll=function(){if(typeof oes_filter!=="undefined"){document.dispatchEvent(new CustomEvent("oes-filter-processing-started"));showWrappers();applyFacetFilter();applyRangeFilter();applyAlphabetFilter();updateWrapperVisibility();updateFacetFilterCount();updateFilterCount();updateLocalStorage();document.dispatchEvent(new CustomEvent("oes-filter-processed"))}};oesFilter.apply=function(filter,type){if($(".oes-archive-filter-"+type+"-"+filter).hasClass("active"))oesFilter.remove(filter,type);else oesFilter.add(filter,type);oesFilter.applyAll()};oesFilter.add=function(filter,type){const filter_item=$(".oes-archive-filter-"+type+"-"+filter);$(".oes-active-filter-"+type).append('<li><a class="oes-active-filter-item oes-active-filter-item-'+filter+'" href="javascript:void(0)" data-filter="'+filter+'"'+" onClick=oesFilter.removeActiveFilter('"+filter+"','"+type+"')><span>"+filter_item[0].childNodes[0].childNodes[0].data+"</span></a></li>");if(!current_filter_post_ids[type]){current_filter_post_ids[type]=oes_filter[type][filter]}else{current_filter_post_ids[type]=current_filter_post_ids[type].concat(oes_filter[type][filter])}filter_item.toggleClass("active");const list=$("#oes-filter-component-"+type).parent();if(!list.hasClass("active"))list.toggleClass("active");if(type in selected_filter){if(!selected_filter[type].includes(filter))selected_filter[type].push(filter)}else selected_filter[type]=[filter]};oesFilter.removeActiveFilter=function(filter,type){oesFilter.remove(filter,type);oesFilter.applyAll()};oesFilter.remove=function(filter,type){$(".oes-active-filter-item-"+filter).parent().remove();$(".oes-archive-filter-"+type+"-"+filter).toggleClass("active");if(!$("#oes-filter-component-"+type+" .oes-archive-filter.active").length)$("#oes-filter-component-"+type).parent().toggleClass("active");if($(".oes-archive-filter.active").length===0){current_filter_post_ids=[]}else{if(current_filter_post_ids.hasOwnProperty(type)){let update_post_ids=[];const active_filter=$('.oes-archive-filter[data-type="'+type+'"].active');for(let filter_item of active_filter){let update_post_ids_temp=update_post_ids,filter_id=filter_item.dataset.filter;update_post_ids=update_post_ids_temp.concat(oes_filter[type][filter_id])}if(update_post_ids.length!==0){current_filter_post_ids[type]=update_post_ids}else{delete current_filter_post_ids[type]}}}if(type in selected_filter){if(selected_filter[type].includes(filter)){if(selected_filter[type].length<2){delete selected_filter[type]}else{const index=selected_filter[type].indexOf(filter);if(index>-1){let temp_selected_filter=selected_filter[type];temp_selected_filter.splice(index,1);selected_filter[type]=temp_selected_filter}}}}};oesFilter.applyAlphabet=function(el){if(!el.classList.contains("inactive")){const alphabet_filter=$(".oes-filter-abc"),alphabet_filter_parent=alphabet_filter.parent();alphabet_filter.removeClass("active");alphabet_filter_parent.removeClass("active");el.classList.toggle("active");$(el).parent().toggleClass("active")}oesFilter.applyAll()};oesFilter.applyPostTypes=function(filter){const count=$(".oes-archive-count-number"),results=$(".oes-post-type-filter");let amount;if(filter==="all"){results.show();amount=results.length}else{results.hide();$(".oes-search-data-row.show").toggleClass("show");$(".oes-archive-plus").attr("aria-expanded","false");$(".oes-post-type-filter-"+filter).show();amount=$(".oes-post-type-filter:visible").length}if(count[0])updateFilterCount(count[0],amount);$(".oes-filter-post-type").removeClass("active");$(".oes-filter-post-type-"+filter).addClass("active")};oesFilter.updateCount=function(){updateFilterCount()};function setFilterVariable(){if(typeof oes_filter=="undefined")oes_filter=[]}function init(){setFilterVariable();const selected_value_store=localStorage.getItem("oesSelectedFilter");if(selected_value_store.length>0){const parsed_value=JSON.parse(selected_value_store);if(parsed_value!=null&&parsed_value.length>0){for(let i=0;i<parsed_value.length;i++){let filterName=parsed_value[i]["type"];if(oes_filter.hasOwnProperty(filterName)){for(let j=0;j<parsed_value[i]["ids"].length;j++){oesFilter.apply(parsed_value[i]["ids"][j],filterName)}}}}}}function showWrappers(){$(".oes-archive-wrapper").show()}function applyFacetFilter(){const items=$(".oes-post-filter-wrapper");if(Object.keys(current_filter_post_ids).length===0){items.show();$(".oes-filter-item-count").show();$(".oes-archive-wrapper").show();$(".oes-active-filter-container").hide()}else{let post_ids=[];if(Object.keys(current_filter_post_ids).length===1){post_ids=current_filter_post_ids[Object.keys(current_filter_post_ids)[0]]}else if(Object.keys(current_filter_post_ids).length!==0){let first_key=Object.keys(current_filter_post_ids)[0],post_ids_temp=current_filter_post_ids[first_key];for(let type in current_filter_post_ids){if(type!==first_key){post_ids_temp=post_ids_temp.filter(value=>current_filter_post_ids[type].includes(value))}}post_ids=post_ids_temp}$(".oes-active-filter-container").show();items.hide();for(let k=0;k<post_ids.length;k++){$(".oes-post-filter-"+post_ids[k]).show()}}}function updateFacetFilterCount(){setFilterVariable();const facet_filter=$(".oes-archive-filter"),visible_wrapper=$(".oes-archive-wrapper:visible");let active_types=[];for(let filter_key in oes_filter){if($("#trigger_"+filter_key+".active").length>0){active_types.push(filter_key)}}for(let k=0;k<facet_filter.length;k++){if($(facet_filter[k]).hasClass("active")){const facet_filter_count=$(facet_filter[k]).children(".oes-filter-item-count");if(facet_filter_count.length>0)facet_filter_count[0].innerHTML="(-)"}else{const type=facet_filter[k].dataset.type,filter=facet_filter[k].dataset.filter;if(active_types.includes(type)){const facet_filter_count=$(facet_filter[k]).children(".oes-filter-item-count");if(facet_filter_count.length>0)facet_filter_count[0].innerHTML="(+)";$(facet_filter[k]).parent().removeClass("inactive");$(facet_filter[k]).parent().show()}else{let collect_current_ids=[];for(let n=0;n<visible_wrapper.length;n++){let visible_items;let ignore_alphabet=false;if($(visible_wrapper[n]).hasClass("oes-ignore-alphabet-filter")){visible_items=$(visible_wrapper[n]);ignore_alphabet=true}else{visible_items=$(visible_wrapper[n]).children(".oes-alphabet-container").children(".oes-post-filter-wrapper:visible");if($(".oes-alphabet-container").length<1){visible_items=$(visible_wrapper[n]).children(".oes-post-filter-wrapper:visible")}}for(let p=0;p<visible_items.length;p++){const class_name=visible_items[p].className;if(ignore_alphabet){collect_current_ids.push(parseInt(visible_items[p].dataset.oesId))}else{collect_current_ids.push(parseInt(class_name.substring(class_name.lastIndexOf("-")+1)))}}}const this_ids=oes_filter[type][filter],intersection_id=this_ids.filter(value=>collect_current_ids.includes(value)),new_count=intersection_id.length;const facet_filter_count=$(facet_filter[k]).children(".oes-filter-item-count");if(facet_filter_count.length>0)facet_filter_count[0].innerHTML="("+new_count+")";if(new_count===0)$(facet_filter[k]).parent().addClass("inactive");else $(facet_filter[k]).parent().removeClass("inactive")}}}}function applyRangeFilter(){const range_slider=$(".oes-range-slider");for(let m=0;m<range_slider.length;m++){const id=range_slider[m].id,valueString=range_slider[m].value,valueArray=valueString.split(";"),items=$(".oes-post-filter-wrapper:visible");let timestamp1=false,timestamp2=false;if(valueArray[0])timestamp1=parseFloat(valueArray[0]);if(valueArray[1])timestamp2=parseFloat(valueArray[1]);if(Number(timestamp1)&&Number(timestamp2)){for(let k=0;k<items.length;k++){const start=parseFloat(items[k].getAttribute("data-"+id)),end=parseFloat(items[k].getAttribute("data-"+id+"-end"));if(isNaN(start)&&isNaN(end)){$(items[k]).hide()}else if(isNaN(end)&&(start<Math.min(timestamp1,timestamp2)||start>Math.max(timestamp1,timestamp2))){$(items[k]).hide()}else if(end<Math.min(timestamp1,timestamp2)||start>Math.max(timestamp1,timestamp2)){$(items[k]).hide()}}}}}function applyAlphabetFilter(){if($(".oes-alphabet-container").length>0){const active_alphabet_filter=$(".oes-filter-abc.active"),items=$(".oes-archive-wrapper");for(let k=0;k<items.length;k++){if($(items[k]).children(".oes-alphabet-container").children(":visible").length<1){$('.oes-filter-abc[data-filter="'+items[k].dataset.alphabet+'"]').addClass("inactive")}else{$('.oes-filter-abc[data-filter="'+items[k].dataset.alphabet+'"]').removeClass("inactive")}}let filter="all";if(active_alphabet_filter.length>0)filter=active_alphabet_filter[0].dataset.filter;if(filter!=="all"){items.hide();$(".oes-alphabet-filter-"+filter).show()}}}function updateWrapperVisibility(){const items=$(".oes-archive-wrapper:not(.oes-ignore-alphabet-filter)");for(let k=0;k<items.length;k++){if($(items[k]).children(":visible").length<1||$(".oes-alphabet-container").length>0&&$(items[k]).children(".oes-alphabet-container").children(":visible").length<1){$(items[k]).hide()}}}function updateFilterCount(){const amount=$(".oes-post-filter-wrapper:visible").length,count_element=$(".oes-archive-count-number");for(let i=0;i<count_element.length;i++)count_element[i].innerText=amount;if(amount===0)$(".oes-archive-container-no-entries").show();else $(".oes-archive-container-no-entries").hide();if(amount===1){$(".oes-archive-count-label-singular").show();$(".oes-archive-count-label-plural").hide()}else{$(".oes-archive-count-label-singular").hide();$(".oes-archive-count-label-plural").show()}}function updateLocalStorage(){let unique_post_ids=[];for(let i in current_filter_post_ids){unique_post_ids=unique_post_ids.concat(current_filter_post_ids[i])}localStorage.setItem("oesResultIDs",JSON.stringify(unique_post_ids));localStorage.setItem("oesSearchResultsURL",window.location.href);let selected_filter_store=[];let i=0;for(const[type,ids]of Object.entries(selected_filter)){selected_filter_store[i]={};selected_filter_store[i]["type"]=type;selected_filter_store[i]["ids"]=ids;i++}let collect_displayed_ids=[];let visible_posts=$(".oes-post-filter-wrapper:visible");for(let n=0;n<visible_posts.length;n++){const class_name=visible_posts[n].className;if(class_name.includes("oes-ignore-alphabet-filter")){collect_displayed_ids.push(parseInt(visible_posts[n].dataset.oesId))}else{collect_displayed_ids.push(parseInt(class_name.substring(class_name.lastIndexOf("-")+1)))}}localStorage.setItem("oesSelectedFilter",JSON.stringify(selected_filter_store));localStorage.setItem("oesDisplayedIds",JSON.stringify(collect_displayed_ids))}})(window.oesFilter||(window.oesFilter={}),jQuery);