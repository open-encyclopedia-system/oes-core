(function(oesLodAdmin,$,undefined){oesLodAdmin.sidebarToggleOptions=function(){$(".oes-lod-sidebar-options").toggleClass("oes-collapsed");$(".oes-lod-sidebar-options-toggle").toggleClass("oes-toggle-collapsed")};oesLodAdmin.toggleOptions=function(){$(".oes-lod-meta-box-api-options-container").toggleClass("oes-collapsed");$(".oes-lod-meta-box-api-toggle").toggleClass("oes-toggle-collapsed")};oesLodAdmin.toggleCopyOptions=function(){$(".oes-lod-meta-box-copy-options-container").toggleClass("oes-collapsed");$(".oes-lod-meta-box-copy-options").toggleClass("oes-toggle-collapsed")};oesLodAdmin.apiRequest=function(){const authority_file=$("#oes-lod-authority-file").children("option:selected").val();showPanel(authority_file);clearTable(authority_file);const search_term=$.trim($("#oes-lod-search-input").val());let params={};$(".oes-lod-search-options").each(function(){params[this.name]=this.value});$(".oes-lod-search-options-block-editor :input").each(function(){if(this.name&&this.value)params[this.name]=this.value});params["search_term"]=search_term;let post_type="post";const attrs=$("body").attr("class").split(" ");$(attrs).each(function(){if("post-type-"===this.substring(0,10)){post_type=this.split("post-type-");post_type=post_type[post_type.length-1]}});params["post_type"]=post_type;if(!search_term.trim()){alert("Please enter a search term to retrieve LOD entries.")}else{$(".oes-lod-results-spinner").show();$.ajax({type:"POST",url:oesLodAJAX.ajax_url,data:{action:"oes_lod_search_query",nonce:oesLodAJAX.ajax_nonce,param:params}}).done(function(data){let retrieved_object=localStorage.getItem("oesLodResults"),temp_results=JSON.parse(retrieved_object);if(!temp_results)temp_results=[];if(data.response.hasOwnProperty("error")||!data.response){alert('Error for trying to get entries for "'+search_term+'". (API: '+authority_file+")")}else{const table=$("#oes-lod-results-table-tbody"),k=temp_results.length;if(data.response.length<1){alert('No results for "'+search_term+'"')}else{for(let i=0;i<data.response.length;i++){const tr=table[0].insertRow(),td1=tr.insertCell(),td2=tr.insertCell(),td3=tr.insertCell(),td4=tr.insertCell(),td5=tr.insertCell(),id=data.response[i]["id"],name=data.response[i]["name"];tr.className="oes-lod-result-entry oes-lod-result-entry-"+authority_file;td1.innerHTML='<input type="radio" name="'+id+'" class="oes-lod-entry-checkbox" value="1" onclick="oesLodAdmin.prepareCopy(this)"/>'+'<label for="'+id+'" class="oes-lod-hidden" style="display:none" id="oes-lod-label-'+id+'">'+name+"</label>";td2.innerHTML='<div class="oes-lod-link-admin">'+'<a href="javascript:void(0)" onclick="oesLodAdmin.preview(this)" '+'data-lod="'+id+'">'+'<img src="'+data.icon_path+'" '+'alt="oes-lod-icon">'+"</a>"+'<div class="oes-lod-admin-preview" style="display:none">'+'<a href="javascript:void(0)" class="oes-lod-admin-preview-close" '+'onclick="oesLodAdmin.previewClose(this)">'+"<span></span></a>"+'<div class="oes-lod-admin-preview-text"></div></div>'+name+"</div>";td2.className="oes-lod-result-name";td3.innerHTML=data.response[i]["type"];td4.innerHTML=id;td5.innerHTML=data.response[i]["link"];temp_results[i+k]=data.response[i]}$("#oes-admin-popup-frame").show();if(data.response.length>0){$(".oes-lod-result-copy").show();$(".oes-lod-result-shortcode").show()}}localStorage.setItem("oesLodResults",JSON.stringify(temp_results));$(".oes-lod-results-spinner").hide()}if(typeof data.copy_options==="undefined")$(".oes-lod-result-copy").hide();else $(".oes-lod-options-list").append(data.copy_options)})}};oesLodAdmin.copyToPost=function(){let params={};const fields=$(".oes-lod-copy-value");for(let i=0;i<fields.length;i++){if(fields[i].previousSibling.previousSibling.previousSibling.checked)params[fields[i].id]=fields[i].innerText}params["oes-lod-authority-file"]=$("#oes-lod-authority-file").children("option:selected").val();if(Object.keys(params).length===0){alert("No data selected.")}else{$.ajax({type:"POST",url:oesLodAJAX.ajax_url,data:{action:"oes_lod_add_post_meta",nonce:oesLodAJAX.ajax_nonce,param:params,post_id:oesLodAJAX.post_id}}).done(function(data){if(data.error)alert(data.error);else window.location.reload()})}};oesLodAdmin.prepareCopy=function(el){const checkboxesTemp=$(".oes-lod-entry-checkbox");for(let ch=0;ch<checkboxesTemp.length;ch++)checkboxesTemp[ch].checked=false;el.checked=true;const fields=$(".oes-lod-copy-value"),shortcode=$("#oes-lod-shortcode");if(fields&&el.checked){let retrieved_object=localStorage.getItem("oesLodResults"),result_array=JSON.parse(retrieved_object),entry=[];for(let j=0;j<result_array.length;j++){if(result_array[j]["id"]==el.name)entry=result_array[j]["entry"]}for(let i=0;i<fields.length;i++){let fieldID=fields[i].id,name=fieldID;name=fieldID.substring(0,fieldID.length-6);if(entry[name]){if(entry[name]["raw"])fields[i].innerHTML=getCellValue(entry[name]["raw"],"list");fields[i].previousSibling.previousSibling.previousSibling.checked=true;const activeRows=$(".oes-lod-result-active");if(activeRows.length>0){for(let k=0;k<activeRows.length;k++)activeRows[k].className=""}el.parentNode.parentElement.classList.add("oes-lod-result-active")}else{fields[i].innerText="";fields[i].previousSibling.previousSibling.previousSibling.checked=false}}}if(shortcode.length>0){const checkboxes=$(".oes-lod-entry-checkbox");let shortcodeText="";for(let m=0;m<checkboxes.length;m++){if(checkboxes[m].checked){if(shortcodeText){shortcodeText+=", "}const label=$.trim($("#oes-lod-label-"+checkboxes[m].name).text()).replace(/,/g,";"),authority_file=$("#oes-lod-authority-file").children("option:selected").val();shortcodeText+="["+authority_file+'link id="'+checkboxes[m].name+'" label="'+label+'"]'}}if(shortcodeText){$("#oes-lod-shortcode-container").show();$("#oes-lod-shortcode").text(shortcodeText)}}};oesLodAdmin.preview=function(el){const retrieved_object=localStorage.getItem("oesLodResults"),result_array=JSON.parse(retrieved_object);let entry=[];for(let j=0;j<result_array.length;j++){if(result_array[j]["id"]==el.dataset.lod)entry=result_array[j]["entry"]}$(".oes-lod-admin-preview").hide();const previewBox=el.nextElementSibling,previewTextElement=previewBox.lastChild;previewBox.style.display="block";if(previewTextElement.innerHTML.trim()===""){let previewText="No information",description=document.createElement("div");description.className="oes-lod-preview-description";previewTextElement.appendChild(description);if(entry){previewText="Information from Database:";let tableContainer=document.createElement("div"),table=document.createElement("TABLE");tableContainer.className="oes-lod-preview-container";previewTextElement.appendChild(tableContainer);table.className="oes-lod-preview";tableContainer.appendChild(table);for(const[key,value]of Object.entries(entry)){let tr=table.insertRow(),td2=tr.insertCell(0),td1=tr.insertCell(0);td2.innerHTML=getCellValue(value["raw"],"<br>");td1.outerHTML="<th>"+value["label"]+"</th>"}}description.innerHTML=previewText}};oesLodAdmin.previewClose=function(el){el.parentElement.style.display="none"};oesLodAdmin.searchOptions=function(el){let authority_file=el;if(el.value!==undefined)authority_file=el.value;$(".oes-lod-search-options").parent().hide();$(".oes-lod-search-options-block-editor").hide();$(".oes-lod-authority-file-container").show();$(".oes-"+authority_file+"-search-options-block-editor").show();$(".oes-"+authority_file+"-search-options").parent().show()};oesLodAdmin.hidePanel=function(){$("#oes-admin-popup-frame").hide();$("#oes-lod-results-table tbody").text("");localStorage.setItem("oesLodResults",null)};function getCellValue(value,separator){let display_value="";if(Array.isArray(value)){if(separator==="list"){display_value+='<ul class="oes-lod-prepare-copy-list">';for(let m=0;m<value.length;m++){display_value+="<li>"+value[m]+"</li>"}display_value+="</ul>"}else{for(let n=0;n<value.length;n++){if(display_value)display_value+=separator;display_value+=value[n]}}}else display_value=value;return display_value}function showPanel(authority_file){$("#oes-admin-popup-frame").show();const tabs=$(".oes-lod-tab-item");for(let i=0;i<tabs.length;i++){if(tabs[i].id==="oes-lod-tab-"+authority_file)tabs[i].className="oes-lod-tab-item active";else tabs[i].className="oes-lod-tab-item"}$(".oes-lod-results-table-header-"+authority_file).show();$(".oes-lod-result-entry").hide();$(".oes-lod-result-entry-"+authority_file).show();$(".oes-lod-further-options-tr").hide();$(".oes-lod-further-options-"+authority_file).show()}function clearTable(authority_file){$(".oes-lod-result-entry-"+authority_file).remove();$(".oes-lod-result-active").remove();$(".oes-lod-copy-option").remove();$("#oes-lod-clear-table").hide();$("#oes-lod-buttons").hide();$("#oes-lod-shortcode").text("No entry selected.");localStorage.setItem("oesLodResults",null)}})(window.oesLodAdmin||(window.oesLodAdmin={}),jQuery);jQuery("#oes-lod-search-input").on("keypress",function(event){if(13===event.which){event.preventDefault();event.stopPropagation();oesLodAdmin.apiRequest()}});